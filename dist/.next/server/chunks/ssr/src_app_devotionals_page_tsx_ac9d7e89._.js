module.exports=[46873,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(65402),e=a.i(9892),f=a.i(99570),g=a.i(66718),h=a.i(91119),i=a.i(86304),j=a.i(29246),k=a.i(80701),l=a.i(73390),m=a.i(70430),n=a.i(70106);let o=(0,n.default)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]);var p=a.i(33508);let q=(0,n.default)("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);var r=a.i(96221),s=a.i(10849);let t=new class{MAX_FILE_SIZE=5242880;ALLOWED_TYPES=["image/jpeg","image/png","image/gif","image/webp"];BUCKET="images";async uploadImage(a,b,c,d=!1){try{this.validateFile(a);let e=a.name.split(".").pop(),f=`${b}/${Date.now()}.${e}`,{data:g,error:h}=await s.supabase.storage.from(this.BUCKET).upload(f,a,{cacheControl:"3600",upsert:!1});if(h)throw h;let i=await this.getImageDimensions(a),{data:j,error:k}=await s.supabase.from("images").insert([{user_id:b,filename:f,original_name:a.name,file_path:g.path,file_size:a.size,mime_type:a.type,width:i.width,height:i.height,alt_text:c||null,is_public:d}]).select().single();if(k)throw k;return j}catch(a){throw console.error("Error uploading image:",a),a}}async uploadMultipleImages(a,b,c){return Promise.all(a.map((a,d)=>this.uploadImage(a,b,c?.[d])))}getPublicUrl(a){let{data:b}=s.supabase.storage.from(this.BUCKET).getPublicUrl(a);return b.publicUrl}async getUserImages(a){try{let{data:b,error:c}=await s.supabase.from("images").select("*").eq("user_id",a).order("created_at",{ascending:!1});if(c)throw c;return b||[]}catch(a){return console.error("Error fetching user images:",a),[]}}async deleteImage(a,b){try{let{data:c,error:d}=await s.supabase.from("images").select("file_path").eq("id",a).eq("user_id",b).single();if(d)throw d;let{error:e}=await s.supabase.storage.from(this.BUCKET).remove([c.file_path]);if(e)throw e;let{error:f}=await s.supabase.from("images").delete().eq("id",a).eq("user_id",b);if(f)throw f}catch(a){throw console.error("Error deleting image:",a),a}}async updateImage(a,b,c){try{let{data:d,error:e}=await s.supabase.from("images").update(c).eq("id",a).eq("user_id",b).select().single();if(e)throw e;return d}catch(a){throw console.error("Error updating image:",a),a}}async linkImageToDevotion(a,b,c=0){try{let{error:d}=await s.supabase.from("devotion_images").insert([{devotion_id:a,image_id:b,display_order:c}]);if(d)throw d}catch(a){throw console.error("Error linking image to devotion:",a),a}}async linkImageToReadingPlan(a,b,c=0){try{let{error:d}=await s.supabase.from("reading_plan_images").insert([{plan_id:a,image_id:b,display_order:c}]);if(d)throw d}catch(a){throw console.error("Error linking image to reading plan:",a),a}}async linkImageToPost(a,b,c=0){try{let{error:d}=await s.supabase.from("post_images").insert([{post_id:a,image_id:b,display_order:c}]);if(d)throw d}catch(a){throw console.error("Error linking image to post:",a),a}}async getDevotionImages(a){try{let{data:b,error:c}=await s.supabase.from("devotion_images").select(`
          images (*)
        `).eq("devotion_id",a).order("display_order",{ascending:!0});if(c)throw c;return b?.flatMap(a=>a.images)||[]}catch(a){return console.error("Error fetching devotion images:",a),[]}}async getReadingPlanImages(a){try{let{data:b,error:c}=await s.supabase.from("reading_plan_images").select(`
          images (*)
        `).eq("plan_id",a).order("display_order",{ascending:!0});if(c)throw c;return b?.flatMap(a=>a.images)||[]}catch(a){return console.error("Error fetching reading plan images:",a),[]}}async getPostImages(a){try{let{data:b,error:c}=await s.supabase.from("post_images").select(`
          images (*)
        `).eq("post_id",a).order("display_order",{ascending:!0});if(c)throw c;return b?.flatMap(a=>a.images)||[]}catch(a){return console.error("Error fetching post images:",a),[]}}createPreview(a){return new Promise((b,c)=>{let d=new FileReader;d.onload=()=>b(d.result),d.onerror=c,d.readAsDataURL(a)})}validateFile(a){if(a.size>this.MAX_FILE_SIZE)throw Error(`File size must be less than ${this.MAX_FILE_SIZE/1024/1024}MB`);if(!this.ALLOWED_TYPES.includes(a.type))throw Error(`File type must be one of: ${this.ALLOWED_TYPES.join(", ")}`)}getImageDimensions(a){return new Promise((b,c)=>{let d=new Image;d.onload=()=>{b({width:d.width,height:d.height})},d.onerror=c,d.src=URL.createObjectURL(a)})}async compressImage(a,b=1920,c=1080,d=.8){return new Promise(e=>{let f=document.createElement("canvas"),g=f.getContext("2d"),h=new Image;h.onload=()=>{let{width:i,height:j}=h;if(i>b||j>c){let a=Math.min(b/i,c/j);i*=a,j*=a}f.width=i,f.height=j,g?.drawImage(h,0,0,i,j),f.toBlob(b=>{b?e(new File([b],a.name,{type:a.type,lastModified:Date.now()})):e(a)},a.type,d)},h.src=URL.createObjectURL(a)})}};var u=a.i(43897);function v({onImagesChange:a,maxImages:d=5,maxFileSize:e=1048576,acceptedTypes:g=["image/jpeg","image/png","image/gif","image/webp"],className:i=""}){let{user:k}=(0,u.useAuth)(),n=(0,c.useRef)(null),[s,v]=(0,c.useState)([]),[w,x]=(0,c.useState)([]),[y,z]=(0,c.useState)(!1),A=(0,c.useCallback)(async a=>{if(!a||!k)return;let b=[];for(let c=0;c<a.length&&s.length+b.length<d;c++){let d=a[c];if(d.size>e){b.push({file:d,preview:"",error:`File size must be less than ${e/1024/1024}MB`});continue}if(!g.includes(d.type)){b.push({file:d,preview:"",error:`File type must be: ${g.join(", ")}`});continue}let f=await t.createPreview(d);b.push({file:d,preview:f,uploading:!0,progress:0})}v(a=>[...a,...b])},[k,s.length,d,e,g]),B=async(b,c)=>{if(k)try{let d=await t.compressImage(b.file);v(a=>a.map((a,b)=>b===c?{...a,progress:50}:a));let e=await t.uploadImage(d,k.id,b.alt_text);v(a=>a.map((a,b)=>b===c?{...a,uploading:!1,progress:100}:a)),x(a=>[...a,e]),a?.([...w,e])}catch(a){v(a=>a.map((a,b)=>b===c?{...a,uploading:!1,error:"Upload failed"}:a))}};return c.default.useEffect(()=>{s.forEach((a,b)=>{a.uploading&&0===a.progress&&B(a,b)})},[s]),(0,b.jsxs)("div",{className:`space-y-4 ${i}`,children:[s.length<d&&(0,b.jsx)(h.Card,{className:`border-2 border-dashed transition-colors ${y?"border-blue-500 bg-blue-50":"border-gray-300"}`,onDragOver:a=>{a.preventDefault(),z(!0)},onDragLeave:a=>{a.preventDefault(),z(!1)},onDrop:a=>{a.preventDefault(),z(!1),A(a.dataTransfer.files)},children:(0,b.jsxs)(h.CardContent,{className:"flex flex-col items-center justify-center py-8",children:[(0,b.jsx)(q,{className:"h-12 w-12 text-gray-400 mb-4"}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-lg font-medium text-gray-900 mb-2",children:"Upload Images"}),(0,b.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:"Drag and drop images here, or click to select files"}),(0,b.jsxs)("p",{className:"text-xs text-gray-400 mb-4",children:["Max ",e/1024/1024,"MB per file â€¢ ",g.join(", ")]}),(0,b.jsxs)(f.Button,{onClick:()=>n.current?.click(),disabled:!k,children:[(0,b.jsx)(o,{className:"h-4 w-4 mr-2"}),"Select Images"]}),!k&&(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"Please log in to upload images"})]})]})}),(0,b.jsx)("input",{ref:n,type:"file",multiple:!0,accept:g.join(","),onChange:a=>A(a.target.files),className:"hidden"}),(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map((a,c)=>(0,b.jsxs)(h.Card,{className:"overflow-hidden",children:[(0,b.jsxs)("div",{className:"relative",children:[a.preview&&(0,b.jsx)("img",{src:a.preview,alt:a.alt_text||"",className:"w-full h-48 object-cover"}),a.uploading&&(0,b.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-white text-center",children:[(0,b.jsx)(r.Loader2,{className:"h-8 w-8 animate-spin mx-auto mb-2"}),(0,b.jsx)("p",{className:"text-sm",children:"Uploading..."}),a.progress&&(0,b.jsx)(l.Progress,{value:a.progress,className:"w-32 mt-2"})]})}),a.error&&(0,b.jsx)("div",{className:"absolute inset-0 bg-red-500 bg-opacity-75 flex items-center justify-center",children:(0,b.jsx)("div",{className:"text-white text-center p-2",children:(0,b.jsx)("p",{className:"text-sm",children:a.error})})}),(0,b.jsx)(f.Button,{size:"sm",variant:"destructive",className:"absolute top-2 right-2 h-8 w-8 p-0",onClick:()=>{v(a=>a.filter((a,b)=>b!==c))},children:(0,b.jsx)(p.X,{className:"h-4 w-4"})})]}),(0,b.jsx)(h.CardContent,{className:"p-4",children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:`alt-text-${c}`,children:"Alt Text (Optional)"}),(0,b.jsx)(j.Textarea,{id:`alt-text-${c}`,placeholder:"Describe this image for accessibility...",value:a.alt_text||"",onChange:a=>{var b;return b=a.target.value,void v(a=>a.map((a,d)=>d===c?{...a,alt_text:b}:a))},disabled:a.uploading,rows:2})]})})]},c))}),s.length>0&&(0,b.jsxs)("div",{className:"text-sm text-gray-500",children:[s.filter(a=>a.uploading).length," uploading,",w.length," completed,",s.filter(a=>a.error).length," failed"]})]})}var w=a.i(90720),x=a.i(86130),y=a.i(71641),z=a.i(15618),A=a.i(14548);function B({onSave:a,onCancel:d}){let{user:e}=(0,u.useAuth)(),{refreshData:l}=(0,y.useUserData)(),[m,n]=(0,c.useState)(""),[o,q]=(0,c.useState)(""),[s,B]=(0,c.useState)(""),[C,D]=(0,c.useState)([]),[E,F]=(0,c.useState)(""),[G,H]=(0,c.useState)([]),[I,J]=(0,c.useState)(!1),K=e?.user_metadata?.full_name||e?.email?.split("@")[0]||"Anonymous",L=()=>{E.trim()&&!C.includes(E.trim())&&(D([...C,E.trim()]),F(""))},M=async()=>{if(!e)return void console.error("User not authenticated");if(!m.trim()||!o.trim())return void console.error("Title and content are required");J(!0);try{let b=w.sampleVerses.find(a=>a.id===s),c={title:m.trim(),content:o.trim(),verse_reference:b?`Verse ${b.number}`:void 0,verse_text:b?b.text:void 0,author_name:K,tags:C.length>0?C:void 0,is_public:!0},d=await x.supabaseService.createDevotionalContent(e.id,c);if(d){if(G.length>0)for(let a=0;a<G.length;a++)await t.linkImageToDevotion(d.id,G[a].id,a);await l(),a&&a(d),n(""),q(""),B(""),D([]),F(""),H([]),console.log("Devotional created successfully:",d)}else console.error("Failed to create devotional")}catch(a){console.error("Error creating devotional:",a)}finally{J(!1)}};return(0,b.jsxs)(h.Card,{className:"w-full max-w-4xl mx-auto",children:[(0,b.jsx)(h.CardHeader,{children:(0,b.jsxs)(h.CardTitle,{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{children:"Create New Devotional"}),(0,b.jsxs)("div",{className:"flex space-x-2",children:[(0,b.jsx)(f.Button,{variant:"outline",onClick:d,disabled:I,children:"Cancel"}),(0,b.jsx)(f.Button,{onClick:M,disabled:I||!m.trim()||!o.trim(),children:I?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(r.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(A.Save,{className:"h-4 w-4 mr-2"}),"Save Devotional"]})})]})]})}),(0,b.jsxs)(h.CardContent,{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Title *"}),(0,b.jsx)(g.Input,{placeholder:"Enter devotional title...",value:m,onChange:a=>n(a.target.value),disabled:I})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Bible Verse"}),(0,b.jsxs)(k.Select,{value:s,onValueChange:B,disabled:I,children:[(0,b.jsx)(k.SelectTrigger,{children:(0,b.jsx)(k.SelectValue,{placeholder:"Select a verse..."})}),(0,b.jsx)(k.SelectContent,{children:w.sampleVerses.map(a=>(0,b.jsx)(k.SelectItem,{value:a.id,children:(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsxs)("div",{className:"font-medium",children:["Verse ",a.number]}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground line-clamp-2",children:a.text})]})},a.id))})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Content *"}),(0,b.jsx)(j.Textarea,{placeholder:"Write your devotional content...",value:o,onChange:a=>q(a.target.value),rows:8,disabled:I})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Tags"}),(0,b.jsxs)("div",{className:"flex space-x-2",children:[(0,b.jsx)(g.Input,{placeholder:"Add a tag...",value:E,onChange:a=>F(a.target.value),onKeyPress:a=>"Enter"===a.key&&L(),disabled:I}),(0,b.jsx)(f.Button,{type:"button",onClick:L,disabled:I,children:(0,b.jsx)(z.Plus,{className:"h-4 w-4"})})]}),C.length>0&&(0,b.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:C.map(a=>(0,b.jsxs)(i.Badge,{variant:"secondary",className:"flex items-center space-x-1",children:[(0,b.jsxs)("span",{children:["#",a]}),(0,b.jsx)(p.X,{className:"h-3 w-3 cursor-pointer",onClick:()=>{D(C.filter(b=>b!==a))}})]},a))})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Images (Optional)"}),(0,b.jsx)(v,{onImagesChange:H,maxImages:3,maxFileSize:1048576,className:"w-full"})]}),(m||o)&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Preview"}),(0,b.jsx)(h.Card,{children:(0,b.jsxs)(h.CardContent,{className:"p-4",children:[(0,b.jsx)("h3",{className:"font-semibold mb-2",children:m||"Untitled"}),s&&(0,b.jsxs)("div",{className:"text-sm text-muted-foreground mb-3 italic",children:['"',w.sampleVerses.find(a=>a.id===s)?.text,'"']}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-3",children:o||"No content..."}),(0,b.jsxs)("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[(0,b.jsxs)("span",{children:["By ",K]}),(0,b.jsx)("span",{children:"Just now"})]}),C.length>0&&(0,b.jsx)("div",{className:"flex flex-wrap gap-1 mt-2",children:C.map(a=>(0,b.jsxs)(i.Badge,{variant:"outline",className:"text-xs",children:["#",a]},a))})]})})]})]})]})}var C=a.i(99272),D=a.i(87532),E=a.i(69012),F=a.i(76472);function G(){let[a,h]=(0,c.useState)(""),[j,k]=(0,c.useState)(null),[l,m]=(0,c.useState)(!1),[n,o]=(0,c.useState)([]),[p,q]=(0,c.useState)(!0);(0,c.useEffect)(()=>{r()},[]);let r=async()=>{try{q(!0);let{data:a,error:b}=await x.supabaseService.getClient().from("devotionals").select("*").eq("is_public",!0).order("created_at",{ascending:!1});b&&console.error("Error fetching public devotionals:",b);let{data:c,error:d}=await x.supabaseService.getClient().from("devotionals").select("*").eq("user_id",(await x.supabaseService.getClient().auth.getUser()).data.user?.id).order("created_at",{ascending:!1});d&&console.error("Error fetching user devotionals:",d);let e=[...c||[],...a||[]].filter((a,b,c)=>b===c.findIndex(b=>b.id===a.id));o(e)}catch(a){console.error("Error fetching devotionals:",a)}finally{q(!1)}},s=n.filter(b=>{let c=b.title.toLowerCase().includes(a.toLowerCase())||b.content.toLowerCase().includes(a.toLowerCase())||b.author_name&&b.author_name.toLowerCase().includes(a.toLowerCase()),d=!j||b.tags&&b.tags.includes(j);return c&&d}),t=Array.from(new Set(n.flatMap(a=>a.tags||[]))),u=async()=>{await r(),m(!1)};return l?(0,b.jsx)(d.Layout,{children:(0,b.jsx)("div",{className:"py-6",children:(0,b.jsx)(B,{onSave:u,onCancel:()=>m(!1)})})}):p?(0,b.jsx)(d.Layout,{children:(0,b.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Loading devotionals..."})]})})}):(0,b.jsx)(d.Layout,{children:(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold",children:"Devotionals"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Daily reflections and spiritual insights to deepen your faith"})]}),(0,b.jsx)(C.AuthGuard,{action:"devotional",children:(0,b.jsxs)(f.Button,{onClick:()=>m(!0),children:[(0,b.jsx)(z.Plus,{className:"mr-2 h-4 w-4"}),"Create Devotional"]})})]}),(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,b.jsxs)("div",{className:"relative flex-1",children:[(0,b.jsx)(D.Search,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(g.Input,{placeholder:"Search devotionals...",value:a,onChange:a=>h(a.target.value),className:"pl-10"})]}),(0,b.jsxs)(f.Button,{variant:"outline",children:[(0,b.jsx)(E.Filter,{className:"mr-2 h-4 w-4"}),"Filters"]})]}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,b.jsx)(i.Badge,{variant:null===j?"default":"secondary",className:"cursor-pointer",onClick:()=>k(null),children:"All"}),t.map(a=>(0,b.jsxs)(i.Badge,{variant:j===a?"default":"secondary",className:"cursor-pointer",onClick:()=>k(a),children:["#",a]},a))]}),(0,b.jsx)("div",{className:"grid gap-6",children:s.map(a=>(0,b.jsx)(e.DevotionalCard,{devotional:a},a.id))}),0===s.length&&(0,b.jsxs)("div",{className:"text-center py-12",children:[(0,b.jsx)(F.Heart,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),(0,b.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"No devotionals found"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Try adjusting your search or filters to find what you're looking for, or create your own devotional."}),(0,b.jsxs)(f.Button,{className:"mt-4",onClick:()=>m(!0),children:[(0,b.jsx)(z.Plus,{className:"mr-2 h-4 w-4"}),"Create Your First Devotional"]})]})]})})}a.s(["default",()=>G],46873)}];

//# sourceMappingURL=src_app_devotionals_page_tsx_ac9d7e89._.js.map