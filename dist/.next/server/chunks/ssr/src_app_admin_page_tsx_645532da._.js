module.exports=[10179,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(43897),e=a.i(10849);let f=class{static async getAllUsers(){let{data:a,error:b}=await e.supabase.from("users").select("*").order("created_at",{ascending:!1});if(b)throw b;return a||[]}static async updateUserRole(a,b){let{error:c}=await e.supabase.from("users").update({role:b}).eq("id",a);if(c)throw c}static async toggleUserStatus(a,b){let{error:c}=await e.supabase.from("users").update({is_active:b}).eq("id",a);if(c)throw c}static async awardPointsToUser(a,b,c){let{error:d}=await e.supabase.from("points_transactions").insert({user_id:a,transaction_type:"admin_bonus",points:b,description:c,metadata:{awarded_by:"admin"}});if(d)throw d;let{error:f}=await e.supabase.from("users").update({points:e.supabase.rpc("increment",{amount:b})}).eq("id",a);if(f)throw f;let{error:g}=await e.supabase.from("user_stats").update({total_points_earned:e.supabase.rpc("increment",{amount:b}),last_activity_at:new Date().toISOString()}).eq("user_id",a);if(g)throw g}static async createNotification(a){let{error:b}=await e.supabase.from("admin_notifications").insert(a);if(b)throw b}static async getAllNotifications(){let{data:a,error:b}=await e.supabase.from("admin_notifications").select("*").order("created_at",{ascending:!1});if(b)throw b;return a||[]}static async updateNotification(a,b){let{error:c}=await e.supabase.from("admin_notifications").update({...b,updated_at:new Date().toISOString()}).eq("id",a);if(c)throw c}static async deleteNotification(a){let{error:b}=await e.supabase.from("admin_notifications").delete().eq("id",a);if(b)throw b}static async sendMessage(a){let{error:b}=await e.supabase.from("user_messages").insert(a);if(b)throw b}static async getSentMessages(a){let{data:b,error:c}=await e.supabase.from("user_messages").select("*").eq("sender_id",a).order("created_at",{ascending:!1});if(c)throw c;return b||[]}static async getReceivedMessages(a){let{data:b,error:c}=await e.supabase.from("user_messages").select("*").eq("recipient_id",a).order("created_at",{ascending:!1});if(c)throw c;return b||[]}static async markMessageAsRead(a){let{error:b}=await e.supabase.from("user_messages").update({is_read:!0,read_at:new Date().toISOString()}).eq("id",a);if(b)throw b}static async createNews(a){let{error:b}=await e.supabase.from("news").insert({...a,published_at:a.is_published?new Date().toISOString():null});if(b)throw b}static async getAllNews(){let{data:a,error:b}=await e.supabase.from("news").select("*").order("created_at",{ascending:!1});if(b)throw b;return a||[]}static async updateNews(a,b){let c={...b};b.is_published&&!b.published_at&&(c.published_at=new Date().toISOString());let{error:d}=await e.supabase.from("news").update({...c,updated_at:new Date().toISOString()}).eq("id",a);if(d)throw d}static async deleteNews(a){let{error:b}=await e.supabase.from("news").delete().eq("id",a);if(b)throw b}static async getAllReferrals(){let{data:a,error:b}=await e.supabase.from("referrals").select("*").order("created_at",{ascending:!1});if(b)throw b;return a||[]}static async getReferralStats(){let{data:a,error:b}=await e.supabase.from("referrals").select("status, points_awarded");if(b)throw b;let c=a||[],d=c.length,f=c.filter(a=>"completed"===a.status).length;return{total_referrals:d,completed_referrals:f,pending_referrals:c.filter(a=>"pending"===a.status).length,total_points_awarded:c.reduce((a,b)=>a+b.points_awarded,0)}}static async getDashboardStats(){let a=new Date().toISOString().split("T")[0],{count:b}=await e.supabase.from("users").select("*",{count:"exact",head:!0}),c=new Date;c.setDate(c.getDate()-7);let{count:d}=await e.supabase.from("users").select("*",{count:"exact",head:!0}).gte("last_login_at",c.toISOString()),{data:f}=await e.supabase.from("points_transactions").select("points"),g=f?.reduce((a,b)=>a+b.points,0)||0,{count:h}=await e.supabase.from("daily_login_rewards").select("*",{count:"exact",head:!0}).eq("login_date",a),{count:i}=await e.supabase.from("users").select("*",{count:"exact",head:!0}).gte("created_at",a);return{total_users:b||0,active_users:d||0,total_points_awarded:g,daily_logins:h||0,new_signups_today:i||0}}static subscribeToUsers(a){return e.supabase.channel("admin-users").on("postgres_changes",{event:"*",schema:"public",table:"users"},async()=>{a(await this.getAllUsers())}).subscribe()}static subscribeToMessages(a,b){return e.supabase.channel(`user-messages-${b}`).on("postgres_changes",{event:"*",schema:"public",table:"user_messages",filter:`recipient_id=eq.${b}`},async()=>{a(await this.getReceivedMessages(b))}).subscribe()}};var g=a.i(91119),h=a.i(99570),i=a.i(66718),j=a.i(70430),k=a.i(29246),l=a.i(80701),m=a.i(86304),n=a.i(75083),o=a.i(24348),p=a.i(60246);let q=(0,a.i(70106).default)("newspaper",[["path",{d:"M15 18h-5",key:"95g1m2"}],["path",{d:"M18 14h-8",key:"sponae"}],["path",{d:"M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a2 2 0 0 1-4 0v-9a2 2 0 0 1 2-2h2",key:"39pd36"}],["rect",{width:"8",height:"4",x:"10",y:"6",rx:"1",key:"aywv1n"}]]);var r=a.i(78138),s=a.i(24669),t=a.i(93518),u=a.i(92759);function v(){let{user:a}=(0,d.useAuth)(),[e,v]=(0,c.useState)([]),[w,x]=(0,c.useState)([]),[y,z]=(0,c.useState)([]),[A,B]=(0,c.useState)([]),[C,D]=(0,c.useState)(null),[E,F]=(0,c.useState)(!0),[G,H]=(0,c.useState)({title:"",message:"",type:"general",target_audience:"all",is_active:!0,expires_at:null}),[I,J]=(0,c.useState)({recipient_id:"",subject:"",message:"",message_type:"message"}),[K,L]=(0,c.useState)({title:"",content:"",excerpt:"",image_url:null,is_featured:!1});(0,c.useEffect)(()=>{a&&M()},[a]);let M=async()=>{if(a)try{F(!0);let[b,c,d,e,g]=await Promise.all([f.getAllUsers(),f.getAllNotifications(),f.getReceivedMessages(a.id),f.getAllNews(),f.getDashboardStats()]);v(b),x(c),z(d),B(e),D(g)}catch(a){console.error("Error loading admin data:",a)}finally{F(!1)}},N=async()=>{try{await f.createNotification(G),H({title:"",message:"",type:"general",target_audience:"all",is_active:!0,expires_at:null}),M()}catch(a){console.error("Error creating notification:",a)}},O=async()=>{if(a)try{await f.sendMessage({...I,sender_id:a.id}),J({recipient_id:"",subject:"",message:"",message_type:"message"}),M()}catch(a){console.error("Error sending message:",a)}},P=async()=>{if(a)try{await f.createNews({...K,is_published:!0,author_id:a.id}),L({title:"",content:"",excerpt:"",image_url:null,is_featured:!1}),M()}catch(a){console.error("Error creating news:",a)}},Q=async(a,b)=>{try{await f.updateUserRole(a,b),M()}catch(a){console.error("Error updating user role:",a)}},R=async(a,b)=>{try{await f.awardPointsToUser(a,b,"Admin bonus"),M()}catch(a){console.error("Error awarding points:",a)}};return E?(0,b.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"w-12 h-12 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Loading admin dashboard..."})]})}):(0,b.jsxs)("div",{className:"container mx-auto p-6 space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold",children:"Admin Dashboard"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Manage your Journey app"})]}),(0,b.jsx)(m.Badge,{variant:"outline",className:"text-sm",children:a?.email})]}),C&&(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[(0,b.jsxs)(g.Card,{children:[(0,b.jsxs)(g.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(g.CardTitle,{className:"text-sm font-medium",children:"Total Users"}),(0,b.jsx)(p.Users,{className:"h-4 w-4 text-muted-foreground"})]}),(0,b.jsx)(g.CardContent,{children:(0,b.jsx)("div",{className:"text-2xl font-bold",children:C.total_users})})]}),(0,b.jsxs)(g.Card,{children:[(0,b.jsxs)(g.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(g.CardTitle,{className:"text-sm font-medium",children:"Active Users"}),(0,b.jsx)(s.TrendingUp,{className:"h-4 w-4 text-muted-foreground"})]}),(0,b.jsx)(g.CardContent,{children:(0,b.jsx)("div",{className:"text-2xl font-bold",children:C.active_users})})]}),(0,b.jsxs)(g.Card,{children:[(0,b.jsxs)(g.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(g.CardTitle,{className:"text-sm font-medium",children:"Daily Logins"}),(0,b.jsx)(t.Award,{className:"h-4 w-4 text-muted-foreground"})]}),(0,b.jsx)(g.CardContent,{children:(0,b.jsx)("div",{className:"text-2xl font-bold",children:C.daily_logins})})]}),(0,b.jsxs)(g.Card,{children:[(0,b.jsxs)(g.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(g.CardTitle,{className:"text-sm font-medium",children:"New Signups"}),(0,b.jsx)(p.Users,{className:"h-4 w-4 text-muted-foreground"})]}),(0,b.jsx)(g.CardContent,{children:(0,b.jsx)("div",{className:"text-2xl font-bold",children:C.new_signups_today})})]}),(0,b.jsxs)(g.Card,{children:[(0,b.jsxs)(g.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(g.CardTitle,{className:"text-sm font-medium",children:"Total Points"}),(0,b.jsx)(r.Gift,{className:"h-4 w-4 text-muted-foreground"})]}),(0,b.jsx)(g.CardContent,{children:(0,b.jsx)("div",{className:"text-2xl font-bold",children:C.total_points_awarded})})]})]}),(0,b.jsxs)(n.Tabs,{defaultValue:"users",className:"space-y-4",children:[(0,b.jsxs)(n.TabsList,{className:"grid w-full grid-cols-5",children:[(0,b.jsx)(n.TabsTrigger,{value:"users",children:"Users"}),(0,b.jsx)(n.TabsTrigger,{value:"notifications",children:"Notifications"}),(0,b.jsx)(n.TabsTrigger,{value:"messages",children:"Messages"}),(0,b.jsx)(n.TabsTrigger,{value:"news",children:"News"}),(0,b.jsx)(n.TabsTrigger,{value:"analytics",children:"Analytics"})]}),(0,b.jsx)(n.TabsContent,{value:"users",className:"space-y-4",children:(0,b.jsxs)(g.Card,{children:[(0,b.jsxs)(g.CardHeader,{children:[(0,b.jsx)(g.CardTitle,{children:"User Management"}),(0,b.jsx)(g.CardDescription,{children:"Manage user roles and permissions"})]}),(0,b.jsx)(g.CardContent,{children:(0,b.jsx)("div",{className:"space-y-4",children:e.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[(0,b.jsx)("div",{className:"flex items-center space-x-4",children:(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:a.username}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:a.email}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Points: ",a.points," | Level: ",a.level," | Streak: ",a.streak]})]})}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsxs)(l.Select,{value:a.role,onValueChange:b=>Q(a.id,b),children:[(0,b.jsx)(l.SelectTrigger,{className:"w-24",children:(0,b.jsx)(l.SelectValue,{})}),(0,b.jsxs)(l.SelectContent,{children:[(0,b.jsx)(l.SelectItem,{value:"user",children:"User"}),(0,b.jsx)(l.SelectItem,{value:"admin",children:"Admin"}),(0,b.jsx)(l.SelectItem,{value:"owner",children:"Owner"})]})]}),(0,b.jsx)(m.Badge,{variant:a.is_active?"default":"secondary",children:a.is_active?"Active":"Inactive"}),(0,b.jsx)(h.Button,{size:"sm",onClick:()=>R(a.id,100),children:"+100 pts"})]})]},a.id))})})]})}),(0,b.jsxs)(n.TabsContent,{value:"notifications",className:"space-y-4",children:[(0,b.jsxs)(g.Card,{children:[(0,b.jsxs)(g.CardHeader,{children:[(0,b.jsx)(g.CardTitle,{children:"Create Notification"}),(0,b.jsx)(g.CardDescription,{children:"Send notifications to users"})]}),(0,b.jsxs)(g.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{htmlFor:"notif-title",children:"Title"}),(0,b.jsx)(i.Input,{id:"notif-title",value:G.title,onChange:a=>H({...G,title:a.target.value}),placeholder:"Notification title"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{htmlFor:"notif-type",children:"Type"}),(0,b.jsxs)(l.Select,{value:G.type,onValueChange:a=>H({...G,type:a}),children:[(0,b.jsx)(l.SelectTrigger,{children:(0,b.jsx)(l.SelectValue,{})}),(0,b.jsxs)(l.SelectContent,{children:[(0,b.jsx)(l.SelectItem,{value:"general",children:"General"}),(0,b.jsx)(l.SelectItem,{value:"announcement",children:"Announcement"}),(0,b.jsx)(l.SelectItem,{value:"maintenance",children:"Maintenance"}),(0,b.jsx)(l.SelectItem,{value:"feature",children:"New Feature"}),(0,b.jsx)(l.SelectItem,{value:"spiritual",children:"Spiritual"})]})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{htmlFor:"notif-message",children:"Message"}),(0,b.jsx)(k.Textarea,{id:"notif-message",value:G.message,onChange:a=>H({...G,message:a.target.value}),placeholder:"Notification message",rows:3})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{htmlFor:"notif-audience",children:"Target Audience"}),(0,b.jsxs)(l.Select,{value:G.target_audience,onValueChange:a=>H({...G,target_audience:a}),children:[(0,b.jsx)(l.SelectTrigger,{children:(0,b.jsx)(l.SelectValue,{})}),(0,b.jsxs)(l.SelectContent,{children:[(0,b.jsx)(l.SelectItem,{value:"all",children:"All Users"}),(0,b.jsx)(l.SelectItem,{value:"admins",children:"Admins Only"}),(0,b.jsx)(l.SelectItem,{value:"users",children:"Regular Users"})]})]})]}),(0,b.jsxs)(h.Button,{onClick:N,className:"w-full",children:[(0,b.jsx)(u.Send,{className:"h-4 w-4 mr-2"}),"Send Notification"]})]})]}),(0,b.jsxs)(g.Card,{children:[(0,b.jsx)(g.CardHeader,{children:(0,b.jsx)(g.CardTitle,{children:"Recent Notifications"})}),(0,b.jsx)(g.CardContent,{children:(0,b.jsx)("div",{className:"space-y-2",children:w.map(a=>(0,b.jsxs)("div",{className:"p-3 border rounded",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h4",{className:"font-medium",children:a.title}),(0,b.jsx)(m.Badge,{variant:a.is_active?"default":"secondary",children:a.is_active?"Active":"Inactive"})]}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:a.message}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-2",children:["Target: ",a.target_audience," | Type: ",a.type]})]},a.id))})})]})]}),(0,b.jsx)(n.TabsContent,{value:"messages",className:"space-y-4",children:(0,b.jsxs)(g.Card,{children:[(0,b.jsxs)(g.CardHeader,{children:[(0,b.jsx)(g.CardTitle,{children:"Send Message"}),(0,b.jsx)(g.CardDescription,{children:"Send direct messages to users"})]}),(0,b.jsxs)(g.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{htmlFor:"msg-recipient",children:"Recipient"}),(0,b.jsxs)(l.Select,{value:I.recipient_id,onValueChange:a=>J({...I,recipient_id:a}),children:[(0,b.jsx)(l.SelectTrigger,{children:(0,b.jsx)(l.SelectValue,{placeholder:"Select a user"})}),(0,b.jsx)(l.SelectContent,{children:e.map(a=>(0,b.jsxs)(l.SelectItem,{value:a.id,children:[a.username," (",a.email,")"]},a.id))})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{htmlFor:"msg-subject",children:"Subject"}),(0,b.jsx)(i.Input,{id:"msg-subject",value:I.subject,onChange:a=>J({...I,subject:a.target.value}),placeholder:"Message subject"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{htmlFor:"msg-content",children:"Message"}),(0,b.jsx)(k.Textarea,{id:"msg-content",value:I.message,onChange:a=>J({...I,message:a.target.value}),placeholder:"Your message",rows:4})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{htmlFor:"msg-type",children:"Message Type"}),(0,b.jsxs)(l.Select,{value:I.message_type,onValueChange:a=>J({...I,message_type:a}),children:[(0,b.jsx)(l.SelectTrigger,{children:(0,b.jsx)(l.SelectValue,{})}),(0,b.jsxs)(l.SelectContent,{children:[(0,b.jsx)(l.SelectItem,{value:"message",children:"Regular Message"}),(0,b.jsx)(l.SelectItem,{value:"announcement",children:"Announcement"}),(0,b.jsx)(l.SelectItem,{value:"warning",children:"Warning"}),(0,b.jsx)(l.SelectItem,{value:"reward",children:"Reward"})]})]})]}),(0,b.jsxs)(h.Button,{onClick:O,className:"w-full",children:[(0,b.jsx)(u.Send,{className:"h-4 w-4 mr-2"}),"Send Message"]})]})]})}),(0,b.jsx)(n.TabsContent,{value:"news",className:"space-y-4",children:(0,b.jsxs)(g.Card,{children:[(0,b.jsxs)(g.CardHeader,{children:[(0,b.jsx)(g.CardTitle,{children:"Create News Article"}),(0,b.jsx)(g.CardDescription,{children:"Publish news and announcements"})]}),(0,b.jsxs)(g.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{htmlFor:"news-title",children:"Title"}),(0,b.jsx)(i.Input,{id:"news-title",value:K.title,onChange:a=>L({...K,title:a.target.value}),placeholder:"Article title"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{htmlFor:"news-excerpt",children:"Excerpt"}),(0,b.jsx)(i.Input,{id:"news-excerpt",value:K.excerpt,onChange:a=>L({...K,excerpt:a.target.value}),placeholder:"Brief description"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{htmlFor:"news-content",children:"Content"}),(0,b.jsx)(k.Textarea,{id:"news-content",value:K.content,onChange:a=>L({...K,content:a.target.value}),placeholder:"Article content",rows:6})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)("input",{type:"checkbox",id:"news-featured",checked:K.is_featured,onChange:a=>L({...K,is_featured:a.target.checked})}),(0,b.jsx)(j.Label,{htmlFor:"news-featured",children:"Featured Article"})]}),(0,b.jsxs)(h.Button,{onClick:P,className:"w-full",children:[(0,b.jsx)(q,{className:"h-4 w-4 mr-2"}),"Publish News"]})]})]})}),(0,b.jsx)(n.TabsContent,{value:"analytics",className:"space-y-4",children:(0,b.jsxs)(g.Card,{children:[(0,b.jsxs)(g.CardHeader,{children:[(0,b.jsx)(g.CardTitle,{children:"Analytics Overview"}),(0,b.jsx)(g.CardDescription,{children:"App performance and user engagement metrics"})]}),(0,b.jsx)(g.CardContent,{children:(0,b.jsxs)(o.Alert,{children:[(0,b.jsx)(s.TrendingUp,{className:"h-4 w-4"}),(0,b.jsx)(o.AlertDescription,{children:"Detailed analytics coming soon! This will include user engagement, reading progress, prayer activity, and community interaction metrics."})]})})]})})]})]})}a.s(["default",()=>v],10179)}];

//# sourceMappingURL=src_app_admin_page_tsx_645532da._.js.map