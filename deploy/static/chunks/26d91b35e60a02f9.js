(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,69908,94773,e=>{"use strict";var r=e.i(43476),t=e.i(932),a=e.i(71645),s=e.i(46462),n=e.i(27142),i=e.i(97078);let o=class{static async trackDailyLogin(e){try{if(await this.getRecentLoginRecord(e))return{pointsAwarded:0,newAchievements:[],streakUpdated:!1};let r=await this.awardDailyLoginPoints(e),t=await this.updateLoginStreak(e),a=await this.checkDailyLoginAchievements(e);return{pointsAwarded:r,newAchievements:a,streakUpdated:t}}catch(e){return console.error("Error tracking daily login:",e),{pointsAwarded:0,newAchievements:[],streakUpdated:!1}}}static async getRecentLoginRecord(e){try{let r=new Date,{data:t,error:a}=await n.supabaseService.getClient().from("daily_login_rewards").select("*").eq("user_id",e).gte("created_at",new Date(r.getTime()-864e5).toISOString()).order("created_at",{ascending:!1}).limit(1).maybeSingle();if(a)return console.error("Error checking recent login:",a),null;return t}catch(e){return console.error("Error getting recent login record:",e),null}}static async awardDailyLoginPoints(e){let r=await n.supabaseService.getUserProfile(e);if(!r)return 0;let t=0;7===r.streak&&(t=10),30===r.streak&&(t=25),100===r.streak&&(t=100);let a=5+t;return await n.supabaseService.addPoints(e,a),await this.recordDailyLogin(e,a),a}static async recordDailyLogin(e,r){try{await n.supabaseService.getClient().from("daily_login_rewards").insert({user_id:e,points_awarded:r})}catch(e){console.error("Error recording daily login:",e)}}static async updateLoginStreak(e){try{let r=await n.supabaseService.getUserProfile(e);if(!r)return!1;let t=new Date,a=new Date(r.updated_at),s=(t.getTime()-a.getTime())/36e5,i=r.streak;if(s<24)return!1;return s<=48?i+=1:i=1,await n.supabaseService.updateStreak(e,i),!0}catch(e){return console.error("Error updating login streak:",e),!1}}static async checkDailyLoginAchievements(e){let r=await n.supabaseService.getUserProfile(e);if(!r)return[];let t=[],a=new Set((await this.getUserAchievements(e)).map(e=>e.achievement_id));for(let s of i.achievements.filter(e=>"daily"===e.category)){if(a.has(s.id))continue;let n=!1;switch(s.id){case"daily-login-1":n=r.streak>=1;break;case"daily-login-7":n=r.streak>=7;break;case"daily-login-30":n=r.streak>=30}n&&(await this.unlockAchievement(e,s.id),t.push(s))}return t}static async unlockAchievement(e,r){try{let t=(0,i.getAchievementById)(r);if(!t||await this.getUserAchievement(e,r))return!1;return await n.supabaseService.getClient().from("user_achievements").insert({user_id:e,achievement_id:r,unlocked_at:new Date().toISOString(),points_awarded:t.points}),await n.supabaseService.addPoints(e,t.points),!0}catch(e){return console.error("Error unlocking achievement:",e),!1}}static async getUserAchievements(e){try{let{data:r,error:t}=await n.supabaseService.getClient().from("user_achievements").select("*").eq("user_id",e).order("unlocked_at",{ascending:!1});if(t)return console.error("Error fetching user achievements:",t),[];return r||[]}catch(e){return console.error("Error getting user achievements:",e),[]}}static async getUserAchievement(e,r){try{let{data:t,error:a}=await n.supabaseService.getClient().from("user_achievements").select("*").eq("user_id",e).eq("achievement_id",r).single();if(a)return console.error("Error fetching user achievement:",a),null;return t}catch(e){return console.error("Error getting user achievement:",e),null}}static async trackActivityAndCheckAchievements(e,r,t){let a=0;try{switch(r){case"verse_read":a=1,await this.checkReadingAchievements(e);break;case"chapter_completed":a=10,await this.checkReadingAchievements(e);break;case"book_completed":a=50,await this.checkReadingAchievements(e);break;case"post_created":a=20,await this.checkCommunityAchievements(e);break;case"friend_added":a=15,await this.checkCommunityAchievements(e);break;default:a=0}return a>0&&await n.supabaseService.addPoints(e,a),{pointsAwarded:a,newAchievements:[]}}catch(e){return console.error("Error tracking activity and achievements:",e),{pointsAwarded:0,newAchievements:[]}}}static async checkReadingAchievements(e){return[]}static async checkCommunityAchievements(e){return[]}static async checkAndAwardAchievements(e){try{let r=[],t=0,a=await n.supabaseService.getUserStats(e);if(!a)return{newAchievements:r,pointsAwarded:0};let s=await n.supabaseService.getUserProfile(e);if(!s)return{newAchievements:r,pointsAwarded:0};let o=await n.supabaseService.getUserAchievements(e),l=new Set(o.map(e=>e.achievement_id));for(let o of i.achievements){if(l.has(o.id))continue;let i=!1;switch(o.id){case"daily-login-1":i=!0;break;case"daily-login-7":case"streak-7":i=s.streak>=7;break;case"daily-login-30":case"streak-30":i=s.streak>=30;break;case"first-verse":i=a.verses_read>0;break;case"chapter-complete":i=a.chapters_completed>=1;break;case"book-complete":i=a.chapters_completed>=10;break;case"testament-complete":i=a.chapters_completed>=50;break;case"bible-complete":i=a.chapters_completed>=1189;break;case"streak-3":i=s.streak>=3;break;case"streak-100":i=s.streak>=100;break;case"first-devotional":i=a.devotionals_created>=1;break;case"devotional-writer":i=a.devotionals_created>=5;break;case"devotional-author":i=a.devotionals_created>=20;break;case"first-prayer":i=a.prayers_shared>=1;break;case"prayer-warrior":i=a.prayers_shared>=10;break;case"prayer-intercessor":i=a.prayers_shared>=50;break;case"first-plan":i=a.reading_plans_started>=1;break;case"plan-completer":i=a.reading_plans_completed>=1;break;case"plan-enthusiast":i=a.reading_plans_started>=5;break;case"first-friend":i=a.friends_count>=1;break;case"social-butterfly":i=a.friends_count>=10;break;case"first-post":i=a.community_posts>=1;break;case"community-leader":i=a.community_posts>=10;break;case"early-bird":i=!!(s.created_at&&new Date(s.created_at)<new Date("2024-01-01"));break;case"point-collector":i=s.points>=100;break;case"point-master":i=s.points>=1e3;break;case"point-legend":i=s.points>=1e4}i&&await n.supabaseService.unlockAchievement(e,o.id)&&(r.push(o),t+=o.points)}return t>0&&await n.supabaseService.addPoints(e,t),{newAchievements:r,pointsAwarded:t}}catch(e){return console.error("Error checking achievements:",e),{newAchievements:[],pointsAwarded:0}}}static async getAchievementStats(e){try{let r=i.achievements,t=await this.getUserAchievements(e),a=new Set(t.map(e=>e.achievement_id)),s=[...new Set(r.map(e=>e.category))],n={};return s.forEach(e=>{let t=r.filter(r=>r.category===e),s=t.filter(e=>a.has(e.id));n[e]={unlocked:s.length,total:t.length}}),{totalAchievements:r.length,unlockedAchievements:t.length,totalPoints:t.reduce((e,r)=>e+r.points_awarded,0),categoryProgress:n}}catch(e){return console.error("Error getting achievement stats:",e),{totalAchievements:0,unlockedAchievements:0,totalPoints:0,categoryProgress:{}}}}};e.s(["achievementService",0,o],94773);let l=(0,a.createContext)(void 0);function c(){let e=(0,t.c)(7),r=(0,a.useContext)(l);if(void 0===r){let r,t,a,s,n,i,o;return e[0]===Symbol.for("react.memo_cache_sentinel")?(r=[],t=[],a=new Date,s=new Date,n=[],e[0]=r,e[1]=t,e[2]=a,e[3]=s,e[4]=n):(r=e[0],t=e[1],a=e[2],s=e[3],n=e[4]),e[5]===Symbol.for("react.memo_cache_sentinel")?(i={id:"fallback",username:"Guest",email:"guest@example.com",fullName:"Guest User",avatar:"",level:1,points:0,streak:0,badges:r,achievements:t,joinedAt:a,lastActive:s,friends:n,settings:{theme:"system",notifications:{email:!0,push:!0,dailyDevotional:!0,friendRequests:!0,messages:!0,achievementAlerts:!0,communityPosts:!1,readingReminders:!0,weeklyProgress:!0},privacy:{profileVisibility:"public",showOnlineStatus:!0,showReadingProgress:!0,allowFriendRequests:!0,showAchievements:!0},reading:{fontSize:"medium",translation:"kjv",dailyReminderTime:"08:00",autoPlayAudio:!1,highlightVerses:!0,showNotes:!0},community:{showInFeed:!0,allowMentions:!0,emailNotifications:!0,pushNotifications:!0,filterContent:!0,hideBlockedUsers:!0}}},e[5]=i):i=e[5],e[6]===Symbol.for("react.memo_cache_sentinel")?(o={user:i,stats:{level:1,points:0,streak:0,badges:[],leaderboard:[]},loading:!1,error:null,updateUser:h,updateStats:m,updateSettings:p,addPoints:g,incrementStreak:u,refreshData:d},e[6]=o):o=e[6],o}return r}async function d(){}async function u(){}async function g(){}async function p(){}async function m(){}async function h(){}function f({children:e}){let{user:t}=(0,s.useAuth)(),[i,c]=(0,a.useState)(null),[d,u]=(0,a.useState)(null),[g,p]=(0,a.useState)(!0),[m,h]=(0,a.useState)(null);(0,a.useEffect)(()=>((async()=>{if(!t){c(null),u(null),p(!1);return}try{p(!0),h(null);let e=await n.supabaseService.getUserProfile(t.id);if(!e&&!(e=await n.supabaseService.createUserProfile(t)))throw Error("Failed to create user profile");if(!await n.supabaseService.getUserStats(t.id))throw Error("Failed to load user stats");let r=await n.supabaseService.getUserAchievements(t.id),a={id:e.id,username:e.username||e.email?.split("@")[0]||"user",email:e.email,fullName:e.full_name||"",avatar:e.avatar_url||"",joinedAt:new Date(e.created_at),points:e.points,level:e.level,streak:e.streak,longestStreak:e.longest_streak||0,friends:[],achievements:r.map(e=>e.achievement).filter(Boolean),settings:{theme:"system",notifications:{email:!0,push:!0,dailyDevotional:!0,friendRequests:!0,messages:!0,achievementAlerts:!0,communityPosts:!1,readingReminders:!0,weeklyProgress:!0},privacy:{profileVisibility:"public",showOnlineStatus:!0,showReadingProgress:!0,allowFriendRequests:!0,showAchievements:!0},reading:{fontSize:"medium",translation:"kjv",dailyReminderTime:"08:00",autoPlayAudio:!1,highlightVerses:!0,showNotes:!0},community:{showInFeed:!0,allowMentions:!0,emailNotifications:!0,pushNotifications:!0,filterContent:!0,hideBlockedUsers:!0}}},s={level:e.level,points:e.points,streak:e.streak,badges:[],leaderboard:[]};c(a),u(s);try{let{newAchievements:e,pointsAwarded:r}=await o.checkAndAwardAchievements(t.id);if(e.length>0){console.log("New achievements unlocked:",e),console.log("Points awarded:",r);let a=await n.supabaseService.getUserAchievements(t.id);c(e=>e?{...e,achievements:a.map(e=>e.achievement).filter(Boolean)}:null)}}catch(e){console.error("Error checking achievements:",e)}n.supabaseService.subscribeToUser(t.id,e=>{c(r=>r?{...r,...e}:null)}),n.supabaseService.subscribeToUserStats(t.id,e=>{console.log("User stats updated:",e)})}catch(e){console.error("Error initializing user data:",e),h(e instanceof Error?e.message:"Failed to load user data")}finally{p(!1)}})(),()=>{n.supabaseService.unsubscribeAll()}),[t]);let f=async e=>{if(t&&i)try{let r={username:e.username,full_name:e.fullName,avatar_url:e.avatar};await n.supabaseService.updateUserProfile(t.id,r)&&c(r=>r?{...r,...e}:null)}catch(e){console.error("Error updating user:",e),h(e instanceof Error?e.message:"Failed to update user")}},y=async e=>{if(t)try{let r=await n.supabaseService.addPoints(t.id,e);r&&(c(e=>e?{...e,points:r.points,level:r.level}:null),u(e=>e?{...e,points:r.points,level:r.level}:null))}catch(e){console.error("Error adding points:",e),h(e instanceof Error?e.message:"Failed to add points")}},_=async()=>{if(t&&i)try{let e=i.streak+1;await n.supabaseService.updateStreak(t.id,e)&&(c(r=>r?{...r,streak:e}:null),u(r=>r?{...r,streak:e}:null))}catch(e){console.error("Error updating streak:",e),h(e instanceof Error?e.message:"Failed to update streak")}},w=async()=>{if(t)try{p(!0);let e=await n.supabaseService.getUserProfile(t.id);e&&(c(r=>r?{...r,points:e.points,level:e.level,streak:e.streak,fullName:e.full_name,avatar:e.avatar_url||""}:null),u(r=>r?{...r,points:e.points,level:e.level,streak:e.streak}:null))}catch(e){console.error("Error refreshing data:",e),h(e instanceof Error?e.message:"Failed to refresh data")}finally{p(!1)}};return(0,r.jsx)(l.Provider,{value:{user:i,stats:d,loading:g,error:m,updateUser:f,updateStats:e=>{d&&u({...d,...e})},updateSettings:e=>{i&&c({...i,settings:{...i.settings,...e}})},addPoints:y,incrementStreak:_,refreshData:w},children:e})}e.s(["UserDataProvider",()=>f,"useUserData",()=>c],69908)},37727,e=>{"use strict";let r=(0,e.i(75254).default)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);e.s(["X",()=>r],37727)},46462,27142,44109,e=>{"use strict";var r=e.i(43476),t=e.i(71645),a=e.i(7471);a.supabase;class s{channels=new Map;getClient(){return a.supabase}async getCurrentUser(){let{data:{user:e}}=await a.supabase.auth.getUser();return e}async getCurrentSession(){let{data:{session:e}}=await a.supabase.auth.getSession();return e}async getUserProfile(e){let{data:r,error:t}=await a.supabase.from("users").select("*").eq("id",e).single();return t?(console.error("Error fetching user profile:",t),null):r}async updateUserProfile(e,r){try{let{data:t,error:s}=await a.supabase.from("users").update(r).eq("id",e).select().single();if(s)return console.error("Error updating user profile:",{error:s,message:s.message,details:s.details,hint:s.hint,code:s.code,userId:e,updates:r}),null;return t}catch(e){return console.error("Unexpected error in updateUserProfile:",e),null}}async createUserProfile(e,r){let t={id:e.id,email:e.email||"",username:r?.username||e.email?.split("@")[0]||"user",full_name:r?.full_name||e.user_metadata?.full_name||"",avatar_url:e.user_metadata?.avatar_url||"",points:0,level:1,streak:0,longest_streak:0,status:"active"};try{let{data:r,error:s}=await a.supabase.from("users").insert(t).select().single();if(s){if(console.error("Error creating user profile:",s),s.message.includes("column")&&s.message.includes("username")){let{data:r,error:s}=await a.supabase.from("users").insert({id:t.id,email:t.email,full_name:t.full_name,avatar_url:t.avatar_url,points:t.points,level:t.level,streak:t.streak,longest_streak:t.longest_streak,status:t.status}).select().single();if(s)return console.error("Error creating user profile without username:",s),null;return await this.createUserStats(e.id),r}return null}return await this.createUserStats(e.id),r}catch(e){return console.error("Error creating user profile:",e),null}}async getUserStats(e){let{data:r,error:t}=await a.supabase.from("user_stats").select("*").eq("user_id",e).single();return t?(console.error("Error fetching user stats:",t),null):r}async updateUserStats(e,r){let{data:t,error:s}=await a.supabase.from("user_stats").update(r).eq("user_id",e).select().single();return s?(console.error("Error updating user stats:",s),null):t}async createUserStats(e){let{data:r,error:t}=await a.supabase.from("user_stats").insert({user_id:e,verses_read:0,chapters_completed:0,devotionals_created:0,prayers_shared:0,friends_count:0,reading_time_minutes:0}).select().single();return t?(console.error("Error creating user stats:",t),null):r}async addPoints(e,r){try{let t=await this.getUserProfile(e);if(!t)return console.error("User profile not found for userId:",e),null;let s=t.points+r,n=Math.floor(s/1e3)+1,{data:i,error:o}=await a.supabase.from("users").update({points:s,level:n,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(o)return console.error("Error updating user profile:",{error:o,message:o.message,details:o.details,hint:o.hint,code:o.code,userId:e,newPoints:s,newLevel:n}),null;return i}catch(e){return console.error("Unexpected error in addPoints:",e),null}}async updateStreak(e,r){let t=await this.getUserProfile(e);if(!t)return null;let a=Math.max(t.longest_streak,r);return await this.updateUserProfile(e,{streak:r,longest_streak:a})}async updateReadingProgress(e,r,t,a=1){let s=await this.getUserStats(e);return s?await this.updateUserStats(e,{verses_read:s.verses_read+a,chapters_completed:s.chapters_completed+ +(a>0)}):null}async createDevotional(e){let r=await this.getUserStats(e);return r?await this.updateUserStats(e,{devotionals_created:r.devotionals_created+1}):null}async createDevotionalContent(e,r){try{let{data:t}=await this.getClient().auth.getUser();if(console.log("Auth check:",t),!t.user)return console.error("User not authenticated"),null;console.log("Creating devotional with data:",{userId:e,devotionalData:r});let{data:a,error:s}=await this.getClient().from("devotionals").insert({user_id:e,title:r.title,content:r.content,verse_reference:r.verse_reference,verse_text:r.verse_text,author_name:r.author_name||"Anonymous",tags:r.tags||[],is_public:!1!==r.is_public}).select().single();if(console.log("Supabase response:",{data:a,error:s}),s)return console.error("Error creating devotional:",{message:s.message,details:s.details,hint:s.hint,code:s.code}),null;return await this.addPoints(e,20),await this.createDevotional(e),a}catch(e){return console.error("Error creating devotional (catch):",{error:e,message:e instanceof Error?e.message:"Unknown error",stack:e instanceof Error?e.stack:void 0}),null}}async createReadingPlan(e,r){try{let{data:t,error:a}=await this.getClient().from("reading_plans").insert({user_id:e,title:r.title,description:r.description,duration:r.duration,difficulty:r.difficulty||"beginner",category:r.category,verses_per_day:r.verses_per_day||3,is_public:!1!==r.is_public}).select().single();if(a)return console.error("Error creating reading plan:",a),null;return await this.addPoints(e,15),t}catch(e){return console.error("Error creating reading plan:",e),null}}async startReadingPlan(e,r){try{let{data:t,error:a}=await this.getClient().from("user_reading_plans").insert({user_id:e,plan_id:r,started_at:new Date().toISOString(),current_day:1,is_active:!0}).select().single();if(a)return console.error("Error starting reading plan:",a),null;return await this.addPoints(e,5),t}catch(e){return console.error("Error starting reading plan:",e),null}}async sharePrayer(e){let r=await this.getUserStats(e);return r?await this.updateUserStats(e,{prayers_shared:r.prayers_shared+1}):null}async addReadingTime(e,r){let t=await this.getUserStats(e);return t?await this.updateUserStats(e,{reading_time_minutes:t.reading_time_minutes+r}):null}async getUserAchievements(r){try{let{data:t,error:a}=await this.getClient().from("user_achievements").select("*").eq("user_id",r);if(a)return console.error("Error fetching user achievements:",a),[];if(!t||0===t.length)return[];let{achievements:s}=await e.A(7462);t.map(e=>e.achievement_id);let n=new Map(s.map(e=>[e.id,e]));return t.map(e=>({id:e.id,user_id:e.user_id,achievement_id:e.achievement_id,unlocked_at:e.unlocked_at,points_awarded:e.points_awarded,achievement:n.get(e.achievement_id)||null}))}catch(e){return console.error("Error in getUserAchievements:",e),[]}}async unlockAchievement(e,r){try{let{data:t}=await this.getClient().from("user_achievements").select("id").eq("user_id",e).eq("achievement_id",r).maybeSingle();if(t)return!0;let{error:a}=await this.getClient().from("user_achievements").insert({user_id:e,achievement_id:r,unlocked_at:new Date().toISOString()});if(a)return console.error("Error unlocking achievement:",a),!1;return!0}catch(e){return console.error("Error unlocking achievement:",e),!1}}async getLeaderboard(e=50){try{console.log("Fetching leaderboard data from optimized table...");let{data:r,error:t}=await a.supabase.from("leaderboard_view").select("*").order("rank_position",{ascending:!0}).limit(e);if(console.log("Leaderboard query result:",{data:r,error:t,count:r?.length}),t)throw t;return r?.map(e=>({id:e.user_id,username:e.username,email:e.email,full_name:e.full_name,avatar_url:e.avatar_url,points:e.total_points,level:e.level,streak:e.streak,longest_streak:e.longest_streak,status:"active",created_at:e.user_created_at,updated_at:e.updated_at}))||[]}catch(r){return console.error("Error fetching leaderboard:",r),this.getLeaderboardFallback(e)}}async getLeaderboardFallback(e=50){try{console.log("Using fallback leaderboard query...");let r=a.supabase.from("users").select("*");try{r=r.eq("status","active")}catch(e){console.log("Status column might not exist, skipping status filter")}let{data:t,error:s}=await r.order("points",{ascending:!1}).limit(e);if(console.log("Fallback leaderboard query result:",{data:t,error:s,count:t?.length}),s)throw s;return t||[]}catch(e){return console.error("Fallback query also failed:",e),[]}}async getWeeklyLeaderboard(e=50){try{console.log("Fetching weekly leaderboard data from optimized table...");let{data:r,error:t}=await a.supabase.from("leaderboard").select("*").order("weekly_points",{ascending:!1}).limit(e);if(console.log("Weekly leaderboard query result:",{data:r,error:t,count:r?.length}),t)throw t;return r?.map(e=>({id:e.user_id,username:e.username,email:"",full_name:"",avatar_url:e.avatar_url,points:e.weekly_points,level:e.level,streak:e.streak,longest_streak:e.longest_streak,status:"active",created_at:e.created_at,updated_at:e.updated_at}))||[]}catch(r){return console.error("Error fetching weekly leaderboard:",r),this.getWeeklyLeaderboardFallback(e)}}async getWeeklyLeaderboardFallback(e=50){try{console.log("Using fallback weekly leaderboard query...");let r=new Date;r.setDate(r.getDate()-7);let t=a.supabase.from("users").select("*").gte("updated_at",r.toISOString());try{t=t.eq("status","active")}catch(e){console.log("Status column might not exist, skipping status filter for weekly leaderboard")}let{data:s,error:n}=await t.order("points",{ascending:!1}).limit(e);if(console.log("Fallback weekly leaderboard query result:",{data:s,error:n,count:s?.length}),n)throw n;return s||[]}catch(e){return console.error("Fallback weekly query also failed:",e),[]}}async getStreakLeaderboard(e=50){try{console.log("Fetching streak leaderboard data from optimized table...");let{data:r,error:t}=await a.supabase.from("leaderboard").select("*").order("streak",{ascending:!1}).limit(e);if(console.log("Streak leaderboard query result:",{data:r,error:t,count:r?.length}),t)throw t;return r?.map(e=>({id:e.user_id,username:e.username,email:"",full_name:"",avatar_url:e.avatar_url,points:e.total_points,level:e.level,streak:e.streak,longest_streak:e.longest_streak,status:"active",created_at:e.created_at,updated_at:e.updated_at}))||[]}catch(r){return console.error("Error fetching streak leaderboard:",r),this.getStreakLeaderboardFallback(e)}}async getStreakLeaderboardFallback(e=50){try{console.log("Using fallback streak leaderboard query...");let r=a.supabase.from("users").select("*");try{r=r.eq("status","active")}catch(e){console.log("Status column might not exist, skipping status filter for streak leaderboard")}let{data:t,error:s}=await r.order("streak",{ascending:!1}).limit(e);if(console.log("Fallback streak leaderboard query result:",{data:t,error:s,count:t?.length}),s)throw s;return t||[]}catch(e){return console.error("Fallback streak query also failed:",e),[]}}async getUserRank(e){try{let{data:r,error:t}=await a.supabase.from("leaderboard").select("rank_position").eq("user_id",e).single();if(!t&&r)return r.rank_position;let{data:s,error:n}=await a.supabase.from("users").select("points").eq("id",e).single();if(n)throw n;let{count:i,error:o}=await a.supabase.from("users").select("*",{count:"exact",head:!0}).eq("status","active").gt("points",s.points);if(o)throw o;return(i||0)+1}catch(e){return console.error("Error fetching user rank:",e),1}}subscribeToLeaderboard(e){let r="leaderboard_updates";if(this.channels.has(r))return this.channels.get(r);let t=a.supabase.channel(r).on("postgres_changes",{event:"*",schema:"public",table:"leaderboard"},async()=>{e(await this.getLeaderboard(50))}).subscribe();return this.channels.set(r,t),t}subscribeToUserRanking(e,r){let t=`user_ranking_${e}`;if(this.channels.has(t))return this.channels.get(t);let s=a.supabase.channel(t).on("postgres_changes",{event:"*",schema:"public",table:"leaderboard",filter:`user_id=eq.${e}`},async e=>{"UPDATE"===e.eventType&&e.new&&r(e.new)}).subscribe();return this.channels.set(t,s),s}subscribeToUser(e,r){let t=`user_${e}`;if(this.channels.has(t))return this.channels.get(t);let s=a.supabase.channel(t).on("postgres_changes",{event:"*",schema:"public",table:"users",filter:`id=eq.${e}`},e=>{"UPDATE"===e.eventType&&e.new&&r(e.new)}).subscribe();return this.channels.set(t,s),s}subscribeToUserStats(e,r){let t=`user_stats_${e}`;if(this.channels.has(t))return this.channels.get(t);let s=a.supabase.channel(t).on("postgres_changes",{event:"*",schema:"public",table:"user_stats",filter:`user_id=eq.${e}`},e=>{"UPDATE"===e.eventType&&e.new&&r(e.new)}).subscribe();return this.channels.set(t,s),s}unsubscribe(e){let r=this.channels.get(e);r&&(a.supabase.removeChannel(r),this.channels.delete(e))}unsubscribeAll(){this.channels.forEach(e=>{a.supabase.removeChannel(e)}),this.channels.clear()}}let n=new s;e.s(["supabaseService",0,n],27142);let i=class{static async getReferralInfo(e){try{console.log("Getting referral info for userId:",e);let{data:r,error:t}=await a.supabase.from("users").select("username, referral_code, email").eq("id",e).single();if(console.log("User data:",r),console.log("User error:",t),t){console.error("Error fetching user:",t),console.error("Error details:",JSON.stringify(t,null,2)),console.error("Error code:",t.code),console.error("Error message:",t.message),console.error("Error details:",t.details);let{data:e}=await a.supabase.auth.getUser();if(e.user&&e.user.email){let r=e.user.email.split("@")[0].toLowerCase().replace(/[^a-zA-Z0-9]/g,"");return console.log("Using auth email for referral code:",r),{referral_code:r,referral_url:`${window.location.origin}/auth?ref=${r}`,total_referrals:0,completed_referrals:0,pending_referrals:0,points_earned:0}}return null}if(!r)return console.log("No user data found"),null;let s=r.referral_code||r.username||r.email.split("@")[0].toLowerCase();console.log("Using referral code:",s);let{data:n,error:i}=await a.supabase.from("referrals").select("status, points_awarded").eq("referrer_id",e);if(console.log("Referrals data:",n),console.log("Referrals error:",i),i)return console.error("Error fetching referrals:",i),{referral_code:s,referral_url:`${window.location.origin}/auth?ref=${s}`,total_referrals:0,completed_referrals:0,pending_referrals:0,points_earned:0};let o=n||[],l=o.filter(e=>"completed"===e.status).length,c=o.filter(e=>"pending"===e.status).length,d=o.reduce((e,r)=>e+(r.points_awarded||0),0);return{referral_code:s,referral_url:`${window.location.origin}/auth?ref=${s}`,total_referrals:o.length,completed_referrals:l,pending_referrals:c,points_earned:d}}catch(e){return console.error("Error getting referral info:",e),null}}static async processReferral(e,r){try{let{data:t,error:s}=await a.supabase.from("users").select("id").eq("referral_code",e).single();if(s||!t)return!1;let{data:n}=await a.supabase.from("referrals").select("id").eq("referred_id",r).single();if(n)return!1;await a.supabase.from("users").update({referred_by:t.id}).eq("id",r);let{error:i}=await a.supabase.from("referrals").insert({referrer_id:t.id,referred_id:r,referral_code:e,status:"pending",points_awarded:0});if(i)throw i;return!0}catch(e){return console.error("Error processing referral:",e),!1}}static async completeReferral(e){try{let{data:r,error:t}=await a.supabase.from("referrals").select("*").eq("id",e).single();if(t||!r)throw t;let{error:s}=await a.supabase.from("referrals").update({status:"completed",points_awarded:100,completed_at:new Date().toISOString()}).eq("id",e);if(s)throw s;await n.addPoints(r.referrer_id,100),await a.supabase.from("points_transactions").insert({user_id:r.referrer_id,transaction_type:"referral",points:100,description:"Referral bonus",metadata:{referred_user:r.referred_id,referral_code:r.referral_code}}),await a.supabase.from("user_stats").update({referrals_completed:a.supabase.rpc("increment",{amount:1}),total_points_earned:a.supabase.rpc("increment",{amount:100})}).eq("user_id",r.referrer_id),await n.addPoints(r.referred_id,50),await a.supabase.from("points_transactions").insert({user_id:r.referred_id,transaction_type:"referral",points:50,description:"Welcome bonus",metadata:{referred_by:r.referrer_id,referral_code:r.referral_code}}),await a.supabase.from("user_stats").update({total_points_earned:a.supabase.rpc("increment",{amount:50})}).eq("user_id",r.referred_id)}catch(e){throw console.error("Error completing referral:",e),e}}static generateReferralUrl(e){return`${window.location.origin}/auth?ref=${e}`}static async validateReferralCode(e){try{let{data:r,error:t}=await a.supabase.from("users").select("id").eq("referral_code",e).single();return!t&&!!r}catch(e){return!1}}static async getReferralHistory(e){try{let{data:r,error:t}=await a.supabase.from("referrals").select(`
          *,
          referred_user:referred_id(id, username, email, created_at)
        `).eq("referrer_id",e).order("created_at",{ascending:!1});if(t)throw t;return r||[]}catch(e){return console.error("Error getting referral history:",e),[]}}static async checkPendingReferrals(e){try{let r=await n.getUserProfile(e);if(!r)return;if(r.points>0||r.streak>0){let{data:r}=await a.supabase.from("referrals").select("id").eq("referred_id",e).eq("status","pending");r&&r.length>0&&await this.completeReferral(r[0].id)}}catch(e){console.error("Error checking pending referrals:",e)}}};e.s(["referralService",0,i],44109);let o=(0,t.createContext)(void 0);function l({children:e}){let[s,n]=(0,t.useState)(null),[l,c]=(0,t.useState)(null),[d,u]=(0,t.useState)(!0);(0,t.useEffect)(()=>{(async()=>{try{let{data:{session:e},error:r}=await a.supabase.auth.getSession();r?(console.error("Error getting initial session:",r),(r.message?.includes("Refresh Token Not Found")||r.message?.includes("Invalid Refresh Token"))&&(console.log("Invalid refresh token, clearing session"),await a.supabase.auth.signOut(),c(null),n(null))):(console.log("Initial session:",e?.user?.email),c(e),n(e?.user??null))}catch(e){console.error("Error getting initial session:",e),c(null),n(null)}finally{u(!1)}})();let{data:{subscription:e}}=a.supabase.auth.onAuthStateChange(async(e,r)=>{console.log("Auth state changed:",e,r?.user?.email),"TOKEN_REFRESHED"!==e||r||(console.log("Token refresh failed, signing out"),await a.supabase.auth.signOut()),c(r),n(r?.user??null),u(!1)});return()=>e.unsubscribe()},[]);let g=async(e,r,t,s)=>{try{if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e))return{success:!1,error:"Please enter a valid email address",message:"Please enter a valid email address"};if(r.length<6)return{success:!1,error:"Password must be at least 6 characters long",message:"Password must be at least 6 characters long"};console.log("Attempting sign up for:",e);let{data:n,error:o}=await a.supabase.auth.signUp({email:e,password:r,options:{data:{full_name:t||e.split("@")[0]},emailRedirectTo:`${window.location.origin}/auth/callback`}});if(o)return console.error("Supabase sign up error:",o),{success:!1,error:o.message||"Failed to create account",message:o.message||"Failed to create account"};if(console.log("Sign up response:",n),s&&n.user&&(console.log("Processing referral:",s),await i.processReferral(s,n.user.id)),n.user&&!n.user.email_confirmed_at)return{success:!0,message:"Please check your email to confirm your account.",needsConfirmation:!0};return{success:!0,message:"Account created successfully!"}}catch(e){return console.error("Unexpected sign up error:",e),{success:!1,error:e.message||"An unexpected error occurred",message:e.message||"An unexpected error occurred"}}},p=async(e,r)=>{try{if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e))return{error:{message:"Please enter a valid email address"}};if(!r)return{error:{message:"Password is required"}};console.log("Attempting sign in for:",e);let{data:t,error:s}=await a.supabase.auth.signInWithPassword({email:e,password:r});if(s)return console.error("Supabase sign in error:",s),{error:s};if(t.user){console.log("Awarding daily login points to:",t.user.id);try{let{data:e,error:r}=await a.supabase.rpc("award_daily_login_points",{user_uuid:t.user.id});r?console.error("Error awarding daily points:",r):console.log("Daily login points awarded:",e)}catch(e){console.error("Error calling daily points function:",e)}try{await i.checkPendingReferrals(t.user.id)}catch(e){console.error("Error checking pending referrals:",e)}}return console.log("Sign in successful:",t.user?.email),{error:null}}catch(e){return console.error("Unexpected sign in error:",e),{error:{message:"An unexpected error occurred"}}}},m=async()=>{try{await a.supabase.auth.signOut(),c(null),n(null),console.log("User signed out successfully")}catch(e){console.error("Error signing out:",e),c(null),n(null)}},h=async e=>{let{error:r}=await a.supabase.auth.resetPasswordForEmail(e);return{error:r}};return(0,r.jsx)(o.Provider,{value:{user:s,session:l,loading:d,signUp:g,signIn:p,signOut:m,resetPassword:h},children:e})}function c(){let e=(0,t.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}e.s(["AuthProvider",()=>l,"useAuth",()=>c],46462)},79474,(e,r,t)=>{"use strict";var a=e.r(71645).__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;t.c=function(e){return a.H.useMemoCache(e)}},932,(e,r,t)=>{"use strict";r.exports=e.r(79474)},97078,e=>{"use strict";let r=[{id:"daily-login-1",name:"First Day",description:"Log in for the first time",icon:"sun",points:5,category:"daily",unlockedAt:new Date},{id:"daily-login-7",name:"Week Warrior",description:"Log in for 7 consecutive days",icon:"calendar",points:50,category:"daily",unlockedAt:new Date},{id:"daily-login-30",name:"Monthly Master",description:"Log in for 30 consecutive days",icon:"calendar",points:200,category:"daily",unlockedAt:new Date},{id:"first-verse",name:"First Steps",description:"Read your first Bible verse",icon:"book-open",points:10,category:"reading",unlockedAt:new Date},{id:"chapter-complete",name:"Chapter Reader",description:"Complete reading an entire chapter",icon:"book-open",points:25,category:"reading",unlockedAt:new Date},{id:"book-complete",name:"Book Scholar",description:"Complete reading an entire book",icon:"book-open",points:100,category:"reading",unlockedAt:new Date},{id:"testament-complete",name:"Testament Master",description:"Complete reading an entire testament",icon:"book-open",points:500,category:"reading",unlockedAt:new Date},{id:"bible-complete",name:"Bible Scholar",description:"Complete reading the entire Bible",icon:"trophy",points:1e3,category:"reading",unlockedAt:new Date},{id:"streak-3",name:"3 Day Streak",description:"Maintain a 3-day reading streak",icon:"flame",points:30,category:"streak",unlockedAt:new Date},{id:"streak-7",name:"Week Warrior",description:"Maintain a 7-day reading streak",icon:"flame",points:75,category:"streak",unlockedAt:new Date},{id:"streak-30",name:"Monthly Master",description:"Maintain a 30-day reading streak",icon:"flame",points:300,category:"streak",unlockedAt:new Date},{id:"streak-100",name:"Century Saint",description:"Maintain a 100-day reading streak",icon:"flame",points:1e3,category:"streak",unlockedAt:new Date},{id:"first-friend",name:"Friend Maker",description:"Add your first friend",icon:"users",points:15,category:"community",unlockedAt:new Date},{id:"social-butterfly",name:"Social Butterfly",description:"Add 10 friends",icon:"users",points:50,category:"community",unlockedAt:new Date},{id:"first-post",name:"Voice Heard",description:"Make your first community post",icon:"message-circle",points:20,category:"community",unlockedAt:new Date},{id:"community-leader",name:"Community Leader",description:"Make 10 community posts",icon:"message-circle",points:100,category:"community",unlockedAt:new Date},{id:"first-devotional",name:"First Devotional",description:"Create your first devotional",icon:"heart",points:20,category:"special",unlockedAt:new Date},{id:"devotional-writer",name:"Devotional Writer",description:"Create 5 devotionals",icon:"heart",points:100,category:"special",unlockedAt:new Date},{id:"devotional-author",name:"Devotional Author",description:"Create 20 devotionals",icon:"heart",points:300,category:"special",unlockedAt:new Date},{id:"first-prayer",name:"First Prayer",description:"Share your first prayer",icon:"hands",points:15,category:"special",unlockedAt:new Date},{id:"prayer-warrior",name:"Prayer Warrior",description:"Share 10 prayers",icon:"hands",points:75,category:"special",unlockedAt:new Date},{id:"prayer-intercessor",name:"Prayer Intercessor",description:"Share 50 prayers",icon:"hands",points:200,category:"special",unlockedAt:new Date},{id:"first-plan",name:"Plan Starter",description:"Start your first reading plan",icon:"calendar",points:10,category:"reading",unlockedAt:new Date},{id:"plan-completer",name:"Plan Completer",description:"Complete your first reading plan",icon:"calendar",points:50,category:"reading",unlockedAt:new Date},{id:"plan-enthusiast",name:"Plan Enthusiast",description:"Start 5 reading plans",icon:"calendar",points:100,category:"reading",unlockedAt:new Date},{id:"point-collector",name:"Point Collector",description:"Earn 100 points",icon:"star",points:50,category:"special",unlockedAt:new Date},{id:"point-master",name:"Point Master",description:"Earn 1000 points",icon:"star",points:100,category:"special",unlockedAt:new Date},{id:"point-legend",name:"Point Legend",description:"Earn 10000 points",icon:"star",points:500,category:"special",unlockedAt:new Date},{id:"early-bird",name:"Early Bird",description:"Read Bible verses before 6 AM for 7 days",icon:"sun",points:150,category:"special",unlockedAt:new Date},{id:"night-owl",name:"Night Owl",description:"Read Bible verses after 10 PM for 7 days",icon:"moon",points:150,category:"special",unlockedAt:new Date},{id:"explorer",name:"Bible Explorer",description:"Read from every book of the Bible",icon:"compass",points:750,category:"special",unlockedAt:new Date}];e.s(["achievements",0,r,"getAchievementById",0,e=>r.find(r=>r.id===e),"getAchievementsByCategory",0,e=>r.filter(r=>r.category===e)])}]);